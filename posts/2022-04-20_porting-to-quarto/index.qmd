---
title: "Porting a distill blog to quarto"
description:
  I have moved this blog from distill over to quarto, and taken notes 
author: "Danielle Navarro"
date: "2022-04-20"
categories: [Quarto, Blogging, Markdown, Distill]
image: "img/anete-lusina-zwsHjakE_iI-unsplash.jpg"
license: "CC BY"
execute: 
  echo: false
citation:
   type: "article-journal"
   container-title: "Notes from a Data Witch"
   url: "https://blog.djnavarro.net/porting-to-quarto"
---

<!--------------- my typical setup ----------------->

```{r setup, include=FALSE}
long_slug <- "2022-04-20_porting-to-quarto"
renv::use(lockfile = "renv.lock")
```

<!--------------- post begins here ----------------->

Go here to download deb file:
https://quarto.org/docs/get-started/

Install quarto:
```
sudo dpkg -i quarto-0.9.282-linux-amd64.deb
```

Instructions for blog:
https://quarto.org/docs/websites/website-blog.html

Create blog from the terminal:
```
quarto create-project quarto-blog --type website:blog
```

```
Creating project at /home/danielle/GitHub/sites/quarto-blog:
  - Created _quarto.yml
  - Created index.qmd
  - Created posts/welcome/index.qmd
  - Created posts/post-with-code/index.qmd
  - Created about.qmd
  - Created styles.css
  - Created posts/_metadata.yml
```

In R:
```
usethis::create_project("~/GitHub/sites/quarto-blog/")
```

In RStudio: 
- the "Render Projects" button in the build tab (ctrl-shift-B) just works
- site builds to the `_site` folder 

First observations:
- feel is like distill, not blogdown: it doesn't use hugo so it is simpler
- the look of the site is different to distill: uses bootstrap, like simple R markdown websites
- overall seems like a lot of good features from the three systems have made it across

Customise:
- Tinker with _quarto.yml file: edit blog title, twitter, github and bootswatch theme. 
- I don't like the font but I'll fix it in CSS later

New post:
- Create new folder `_posts/2022-04-20_porting-to-quarto` and file `index.qmd`
- Add basic yml metadata
- Start writing this post, and build!

Second observation: the starter blog has dates in the wrong format if you want them to be indexed properly when the entire blog builds. The "Welcome to My Blog" post is dated "17/04/2022" which is parsed as a string literal rather than a date. On the post itself it shows up as is but on the indexing page it is rendered "May 4, 2023". You can fix this by setting date using the much beloved ISO 8601 standard: "2022-04-17".

Can I add footnotes?^[Yes] Can they be nested?^[No^[No]]

Can I add asides? 

<aside>Also yes</aside>

Return to the yaml header for the post:
- `description` still does what it used to: provides preview text on the listing page and a summary at the top of the file
- `citation` from distill doesn't work the way it used to but the new thing is better anyway. https://quarto.org/docs/reference/metadata/citation.html
- `categories` takes a list of values, as before
- `image` takes a relative path to the image file, and is the same as `preview` used to be
- `licence` replaces the `creative_commons` key, but has the same effect
- some of the hyper specific distill things (e.g., orcid) are gone, but I'm happy to lose those

<!-- Anete Lūsiņa -->
<!-- https://unsplash.com/photos/zwsHjakE_iI -->

Okay, delete the two posts that came with the starter blog, let's try to import my own! Copy and paste my "welcome" post, rename the .Rmd to .qmd... how much work do I need to do?

Not too much. I've made a decision to simplify my reproducibility workflow, so that instead of using `refinery` I've reverted to calling `renv::use()` within the post, and keeping the lock file within the individual post folder. That required a bit of tinkering, but that's hyperspecific to my blog and not actually very much work anyway



<!--------------- appendices go here ----------------->

```{r, echo=FALSE}
markdown_appendix <- function (name, content) {
    paste(paste("##", name, "{.appendix}"), " ", content, sep = "\n")
}

markdown_link <- function (text, path) {
    paste0("[", text, "](", path, ")")
}

insert_source <- function(repo_spec, name, 
                          collection = "posts", 
                          branch = "main", 
                          host = "https://github.com", 
                          text = "source code") {
    path <- paste(host, repo_spec, "tree", branch, paste0("_", 
        collection), name, "index.Rmd", sep = "/")
    return(markdown_link(text, path))
}

insert_timestamp <- function(tzone = Sys.timezone()) {
    time <- lubridate::now(tzone = tzone)
    stamp <- as.character(time, tz = tzone, usetz = TRUE)
    return(stamp)
}

insert_lockfile <- function (repo_spec, name, 
                             collection = "posts", 
                             branch = "main", 
                             host = "https://github.com", 
                             text = "R environment") {
    collection <- paste0("_", collection)
    path <- paste(host, repo_spec, "tree", branch, collection, 
        name, "renv.lock", sep = "/")
    return(markdown_link(text, path))
}

insert_appendix <- function (repo_spec, name, collection = "posts") {
    appendices <- paste(markdown_appendix(name = "Last updated", 
        content = insert_timestamp()), " ", markdown_appendix(name = "Details", 
        content = paste(insert_source(repo_spec, name, collection), 
            insert_lockfile(repo_spec, name, collection), sep = ", ")), 
        sep = "\n")
    knitr::asis_output(appendices)
}

insert_appendix("djnavarro/quarto-blog", long_slug)
```



